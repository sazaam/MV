extends ../layout
block content
	#frame.frame.abs.left0.top0.right0.bottom0.fullW.fullH.darkBG.coloraddict.context
		.back.abs.left50.top50.flowvisible.fullW.fullH
			.abs.gridded.fullW.fullH(style="left:-50%;top:-50%")
			//- 
		.testzone.fullW.fullH(class="flex content-center justify-center justify-items-center")
			
		




	script(type="text/javascript", src="/js/strawnode.js?starter=./strawnode_app/") 
	
	//- script(type="text/javascript").
		// TEST JADE RENDER ;
		(()=>{

			var str = `
		a.sazaam(class="coucou", href="#/en/")
			| toto
		div.abs.top0.left0()
			a(href="#/en/")
			` ;
			trace(Jade.render(str)) ;

			})() ;
			

	script(type="text/javascript").
		Express.app.listen('load', function(e){
			trace('LOADED') ;

			const replace = (str, o) => str.replaceAll(/\{([^}]+)\}/gi, (_, a) => a.split('.').reduce((b, c) => b?.[c], o)) ;
			
			if(true) (()=>{
				
				const data = {
					background:{
						start:'#333333'
					},
					size: {
						w: 100,
						h: 100
					},
					pos:{
						left:0,
					}
				}
				
				var box_txt = replace('.box.rel(style="width:{size.w}px;height:{size.h}px;background-color:{background.start};left:{pos.left}px;")', data) ;
				var play_txt = replace('a.play.abs.pad.RmarXXXXLg.right0.top50.whitetranspBG.rounded.white(style="top:50%;margin-top:-1.5em", href="javascript:void(0)") Play', data) ;
				
				$(Jade.render(box_txt)).appendTo('.testzone') ;
				$(Jade.render(play_txt)).appendTo('.frame') ;
				

				var box = $('.box') ;
				var play = $('.play') ;

				var tw ;

				play.on('mousedown', function(e){
					if(!!tw && tw.isPlaying) tw.stop() ;
					tw = BJS.create({
						target:box,
						to:{'$left::px':50},
						from:{'$left::px':-50, 'background-color':{
							'r':-120,
							'g':0,
							'b':0
						}},
						cuepoints:{
							'$left::px':[-300, 300]
						},
						time:1.825,
						ease:Sine.easeOut
					}) ;
					tw.play() ;
				})








			})() ;





			// TEST TEXT DISAPPEAR / REAPPEAR
			if(false) (()=>{

				var txt = 'a.saz(class="flex-1") We all live in a brand new world <span class="bold" style="color:lightblue">indeed and for a very, very long time</span>.' ;
				$(Jade.render(txt)).appendTo('.testzone') ;

				var saz = $('.saz') ;
				var sss = saz.html() ;
				var sss2 = sss ;
				var timeperchar = .02 ;

				var time = (saz.text().length) * timeperchar ;

				var n = 0 ;

				var tw = BJS.serial(
					BJS.create({
						target:saz,
						time:time,
						ease:Expo.easeOut,
						onComplete:function(){
							trace('OK ' + n)
						},
						onUpdate:function(){
							if(sss[sss.length-1] == '>'){
								var ind = sss.lastIndexOf('<') ;
								if(ind != -1){
									sss = sss.substring(0, ind)
								}
							}
							saz.html(sss = sss.slice(0, -1)) ;
						}
					}),
					BJS.create({
						target:saz,
						time:time,
						ease:Expo.easeOut,
						onComplete:function(){
							trace('KO ' + n)
							n++;
						},
						onUpdate:function(){
							if(sss2[sss.length] == '<'){
								var temp = sss2.replace(sss, '') ;
								sss += temp.substr(0, temp.indexOf('>') + 1) ;
							}
							saz.html(sss = sss2.slice(0, sss.length + 1)) ;
						}
					})
				) ;
				
				tw.play() ;

			})() ;







		})